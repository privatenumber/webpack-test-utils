import g from"fs";import m from"webpack";import{ufs as w}from"unionfs";import{createFsRequire as p}from"fs-require";import f from"path";import{createFsFromVolume as h,Volume as v}from"memfs";function y(){const o={};return o.promise=new Promise((e,i)=>{o.resolve=e,o.reject=i}),o}class j{constructor(e){this.options=e}apply(e){Object.assign(e,this.options)}}const a=o=>{const e=h(v.fromJSON(o));return Object.assign(e,{join:f.join}),e},b=()=>({mode:"production",target:"node",context:"/",entry:{index:"/src/index.js"},resolve:{modules:[f.resolve("node_modules"),"node_modules"]},resolveLoader:{modules:[f.resolve("node_modules"),"node_modules"]},module:{rules:[]},optimization:{minimize:!1},output:{filename:"[name].js",path:"/dist",libraryTarget:"commonjs2",libraryExport:"default"},plugins:[]});function d(o,e,i=m){const r=b();return e&&e(r),Array.isArray(r.plugins)||(r.plugins=[]),r.plugins.unshift(new j({inputFileSystem:w.use(g).use(o),outputFileSystem:o})),i(r)}function F(o,e,i=m){const r=a(o);return new Promise((c,n)=>{d(r,e,i).run((s,u)=>{if(s){n(s);return}c({stats:u,fs:r,require:p(r)})})})}function x(o,e,i=m){const r=a(o),c=d(r,e,i);let n,t=null;return{fs:r,require:p(r),async build(s=m.version.startsWith("4.")){if(t)throw new Error("Build in progress");return t=y(),n?s&&n.invalidate():n=c.watch({},async(u,l)=>{if(u){t==null||t.reject(u),t=null;return}t==null||t.resolve(l),t=null}),await t.promise},close(){return new Promise((s,u)=>{n.close(l=>{if(l)return u(l);s()})})}}}export{F as build,x as watch};
